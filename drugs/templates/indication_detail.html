{% extends "home/base.html" %}
{% load static %}
{% load structure_extras %}


{% block content %}
<style>
.link {
  fill: none;
  stroke: #969696;
  stroke-opacity: .1;
}
.link:hover {
  stroke-opacity: .3;
}
</style>

<div class="row text-success">
    <div class="text-center">
        <h2>{{indication}}</h2>
    </div>
</div>


<div class="row">
    <div class="col-md-2 text-right text-info">
        <h4>ONTOLOGY PAGE</h4>
    </div>
    <div class="col-md-10">
      <a href="https://icd.who.int/browse/2024-01/mms/en#{{indication_uri}}" target="_blank">{{indication_code}}</a>
    </div>
</div>

<div class="row">
    <div class="col-md-2 text-right text-info">
        <h4>SANKEY PLOT</h4>
    </div>
    <div class="col-md-10">
      <!-- Create a div where the graph will take place -->
      <div id="sankey_plot"></div>
      <p>
        <div class="btn-group">
          <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false">
          <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
          <li>
              <a href="javascript:saveSvgAsPng(document.getElementById('sankey'), 'sankey_{{indication}}.png');">PNG</a>
          </li>
          <li>
              <a href="javascript:saveSvgAsJpg(document.getElementById('sankey'), 'sankey_{{indication}}.jpg');">JPG</a>
          </li>
          <li>
              <a href="javascript:saveSvgAsTiff(document.getElementById('sankey'), 'sankey_{{indication}}.tiff');">TIFF</a>
              </a>
          </li>
          </ul>
      </div>
    </p>
  </div>
</div>

<div class="row">
    <div class="col-md-2 text-right text-info">
        <h4>PROTEIN TARGETS</h4>
    </div>
    <div class="col-md-10">
      {% for prot in targets %}
          <p style="display: inline;"><a href="/protein/{{ prot }}" target="_blank">{{ prot }}</a>{% if forloop.last %} {% else %}, {% endif %}</p>
      {% endfor %}
    </div>
</div>

<div class="row">
    <div class="col-md-2 text-right text-info">
        <h4>DRUGS</h4>
    </div>
    <div class="col-md-10">
      {% for pair in ligands %}
          <p style="display: inline;"><a href="/ligand/{{ pair.1 }}/info" target="_blank">{{ pair.0|safe }}</a>{% if forloop.last %} {% else %}, {% endif %}</p>
      {% endfor %}
    </div>
</div>

<div class="row">
    <div class="col-md-2 text-right text-info">
        <h4>MAYBE WE CAN PUT A TABLE HERE?</h4>
    </div>
</div>
{% endblock %}


{% block addon_css %}
    <link href="{% static 'home/css/sequenceviewer.css' %}" rel="stylesheet">
    <link href="{% static 'home/css/color_picker.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'home/css/jquery.dataTables.min.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'home/css/construct_browser.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'home/css/yadcf_bootstrap_version.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'home/css/select2.css' %}" type="text/css" />
    <link href="{% static 'home/css/construct_alignment.css' %}" rel="stylesheet">
    <link href="{% static 'home/css/sequenceviewer.css' %}" rel="stylesheet">
    <link href="{% static 'home/css/modal.css' %}" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/jquery.powertip.css' %}" />
{% endblock %}

{% block addon_js %}
    <script src="{% static 'home/js/d3.min.js' %}"></script>
    <script src="{% static 'home/js/nv.d3.min.js' %}"></script>
    <script src="{% static 'home/js/saveSvg.js' %}"></script>
    <script src="{% static 'home/js/d3.v4.min.js' %}"></script>
    <script src="{% static 'home/js/sankey.js' %}"></script>
    <script src="{% static 'home/js/saveSvgAsPng.js' %}"></script>

    <script type="text/javascript">
    var sankey_data = JSON.parse('{{ sankey|safe }}');
    var top_nodes = '{{ nodes_nr|safe }}';
    var totalPoints = '{{ points }}';
    // set the dimensions and margins of the graph
    // set height iteratively based on highest number of nodes
    // console.log(sankey_data);
    SankeyPlot(sankey_data, 'sankey_plot', top_nodes, totalPoints,1300);
    </script>
{% endblock %}
