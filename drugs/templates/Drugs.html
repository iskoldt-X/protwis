{% extends "home/base.html" %}
{% load static %}
{%block addon_css%}
<link rel="stylesheet" href="{% static 'home/css/structure_browser.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'home/css/NewDrugsBrowser_datatables.min.css' %}" type="text/css"/>
<link rel="stylesheet" href="{% static 'home/css/select2_4.1.0-rc.0._full.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'home/css/BusyLoad.css' %}" type="text/css">


<style type="text/css">
  table.dataTable thead th,
  table.dataTable tbody td {
    max-width: 1px;
    word-break: break-word;
    overflow: hidden;
    white-space: nowrap;
  }
  .dataTables_length {
    position: relative;
    white-space:pre-wrap;
  }

.select2-search__field::placeholder{
    text-align:center;
}


.select2-container--default .select2-selection--multiple{
    overflow: hidden !important;
}
#Init_loader {
    margin-left: 45%;
    top: 50%;
    position: absolute;
    display: none;
}

/* #Table_example {display: none} */

</style>
{%endblock%}
{%block content%}
<!-- <div style="padding-top: 10px; font-size: 14px; white-space: nowrap;">
  <button onclick="reset_all()">Reset</button>
</div> -->
<div style="padding-top: 10px; font-size: 11px; white-space: nowrap;">
  <div id="Init_loader"></div>  
  <table width="100%" class="display compact" id="Table_example">
    <!-- <table width="100%" class="display" id="Table_example"> -->
      <thead>
        <!-- !!! Stupid work around !!! Fixed headers and resposive tables havent work out the issue of complex headers yet, 
          so inserting a "dummy header row" this allows the table to correspond correctly. 
          Should have been fixed by patch 2.1.0 responsive, but still not working..." -->
        <!-- <script type="text/javascript">
            var timerStart = Date.now();
        </script> -->
        <tr> 
          <td style="text-align: center" data-dt-order="disable"></td>

          <td style="text-align: center" data-dt-order="disable"></td>

          <td style="text-align: center" data-dt-order="disable"></td>
          <td style="text-align: center" data-dt-order="disable"></td>
          <td style="text-align: center" data-dt-order="disable"></td>
        </tr>
        <!-- ## Super header row ## -->
        <tr style="padding-top: 10px; font-size: 14px; white-space: nowrap;">
          <th colspan="1" id="Complex_header_1" style="text-align: center;" data-dt-order="disable">Drugs</th>
          <th colspan="1" id="Complex_header_2" style="text-align: center;" data-dt-order="disable">Targets</th>
          <th colspan="3" id="Complex_header_3" style="text-align: center;" data-dt-order="disable">Indications</th>
        </tr>
        <!-- ## header row ## -->
        <tr>
          <th style="text-align: center;">Name</th>
          <th style="text-align: center;">Number of targets</th>
          <th style="text-align: center;">approved</th>
          <th style="text-align: center;">in trial</th>
          <th style="text-align: center;">untapped</th>
        </tr>
        <!-- ## Filter row ## -->
        <tr>
          <td style="text-align: center" data-dt-order="disable"></td>

          <td style="text-align: center" data-dt-order="disable"></td>
          
          <td style="text-align: center" data-dt-order="disable"></td>
          <td style="text-align: center" data-dt-order="disable"></td>
          <td style="text-align: center" data-dt-order="disable"></td>
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
</div>
{%endblock%}

{%block addon_js%}

<script src="{% static 'home/js/DataTables_v2.0.5.js' %}"></script>
<script src="{% static 'home/js/Test2.js' %}"></script>
<script src="{% static 'home/js/Test3.js' %}"></script>
<script src="{% static 'home/js/Test6.js' %}"></script>
<script src="{% static 'home/js/bootstrap2-toggle.min.js' %}"></script>
<script src="{% static 'home/js/select2_4.1.0-rc.0_full.js' %}"></script>
<script src="{% static 'home/js/dataTables.absolute.js' %}"></script>
<script src="{% static 'home/js/NorgesDTFilterBuilder.js' %}"></script>
<script src="{% static 'home/js/BusyLoad.js' %}"></script>
<script>

// ##########################################################################################################
// ##                                 Load the data as a js variable                                       ##
// ## only outside the document ready function for debugging purposes (doesnt like the django code format) ##
// ##########################################################################################################

var drugs_data = {{Data_Drugs|safe}};
var table1;

// ######################
// ## Ordering schemes ##
// ######################

// var numbersType = $.fn.dataTable.absoluteOrderNumber( [
//     { value: 'None', position: 'bottom' }
//   ] );
// var namesType = $.fn.dataTable.absoluteOrder( [
//   { value: 'unknown', position: 'bottom' }
// ] );

// ###############################
// ### Initialization loader   ###
// ###############################
$("#Init_loader").show();
$("#Init_loader").busyLoad("show", { spinner: "accordion", text: "Loading",fontSize: "3rem",textPosition: "top",textMargin: "-6rem",color: "black",background: "white",});

// ###############################
// ### Document ready function ###
// ###############################
$(document).ready(function() {
  
// #############################
// ### Create the Datatable  ###
// #############################

var table1 = $('#Table_example').DataTable({
  // ####################
  // ## Table settings ##
  // ####################

  // ## Layout positions ##
  dom: 
  "<'row'<'col-sm-12 dt-btn'B>>" +
    "<'row'<'col-sm-6'l><'col-sm-3'><'col-sm-3'f>>" +
    "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-12'ip>>",

  // ##  Common settings ##
  // order: [1,"asc"],
  pageLength: 20,
  lengthMenu: [10, 20, 50, 100, 500, 1000],
  language : {
    sLengthMenu: "_MENU_"
  },
  // serverSide: false,
  deferRender: true,
  scrollY: "50vh",
  scrollX: true,
  scrollCollapse: true,
  scroller: true,
  paging: true,
  responsive: true,
  "sScrollX": "200%", 
  "sScrollXInner": "200%",
  
  // ###################
  // ## Load the data ##
  // ###################
  
  data: drugs_data,

  // ###################
  // ##  Column data  ##
  // ###################

  columns:[

  
  // ######################
  // #  Column 1 - Drugs  #
  // ######################
  
  {data: "Drugs",
    name: "Drug",
    render: function (data, type, row, meta) { // To put links into the table data use the render function.
      data = '<a href="/ligand/' + row.Drug_id + '/info' + '" target="_blank">' + data + '</a>';
      return data},
    width:'20%'},
  // ##################################
  // #  Column 1 - Number of targets  #
  // #################################
  {data: "Targets",
  name: "Number of targets",
  width:'20%'},

  // ######################
  // #  Column 1 - Drugs  #
  // ######################

  {data: "Drug_id",
  name: "Drug",
  width:'20%',
    render: function (data, type, row, meta) { // To put links into the table data use the render function.
      return "coming soon"}},

  // ######################
  // #  Column 1 - Drugs  #
  // ######################  

  {data: "Drug_id",
  name: "Drug",
  width:'20%',
    render: function (data, type, row, meta) { // To put links into the table data use the render function.
      return "coming soon"}},
  
  // ######################
  // #  Column 1 - Drugs  #
  // ######################

  {data: "Drug_id",
  name: "Drug",
  width:'20%',
    render: function (data, type, row, meta) { // To put links into the table data use the render function.
      return "coming soon"}}, 
  
  ],

  // ###################################################
  // ## Define ordering - Handles special case values ##
  // ###################################################

  columnDefs: [
    // { type: numbersType, targets: 8 },
    // { type: namesType, targets: 10 },
    // {visible: false, targets: 0 },
    {className: "dt-body-center expand", "targets": "_all"}
    ],
  
  // ############################
  // ### Table control button ###
  // ############################

  buttons: [
    { 
      text: 'Table control',
      extend: 'colvis',
      columns: [0,1,2,3,4],
      popoverTitle: 'Individual columns',
      collectionLayout: ['fixed two-column'],
      popoverTitle: 'Column visibility control',
      postfixButtons: ['colvisRestore'],

      },
      {
        text: 'Reset filters',
        action: function (e, dt, node, config) {
          reset_all();
        }
              }],
  initComplete : function () {
    $("#Init_loader").busyLoad("hide", { spinner: "accordion", text: "Loading",fontSize: "3rem",textPosition: "top",textMargin: "-6rem"});
    $("#Init_loader").hide()
    $("#Table_example").show();
  }
  }); // End of DataTables

  // #############################
  // ###    Create Filters     ###
  // #############################

  var column_filters = [];

  // CreateColumnFilters --> CreateColumnFilters(datatable_selector,column_number, column_range, filter_type)
  column_filters = column_filters.concat(CreateColumnFilters(table1,0,5,"Multi-select-unspecific","10px"));

  // #############################
  // ###   Initialize filters  ###
  // #############################
  
  createDropdownFilters(table1,column_filters);
        
}); // End document ready function

// #############################
// ### Reset button function ###
// #############################

function reset_all() {
  $('.select2').val(null).trigger('change');
}

</script>
{%endblock%}


